{% extends 'base.html' %}
{% load static %}
{% block title %}
  {{ service.name }} | جزییات سرویس
{% endblock %}

{% block content %}
  <style>
    /* --- Service Detail (scoped) -------------------------------------------- */
    .srv-d-wrap {
      direction: rtl;
      text-align: right;
      color: #e9eef6;
    }
    .srv-d-container {
      width: min(1200px, 92vw);
      margin-inline: auto;
      padding: 16px 0;
    }
    
    /* رنگ‌ها فقط برای این بخش—با تم خودت می‌تونی عوض کنی */
    :root {
      --srvd-border: #223148;
      --srvd-muted: #9aa6b2;
      --srvd-badge: #cfe1ff;
    }
    
    /* هِرو */
    .srv-d-hero {
      display: grid;
      gap: 24px;
      grid-template-columns: 1.2fr 2fr;
      background: linear-gradient(180deg, #101722, #0c1118);
      border: 1px solid var(--srvd-border);
      border-radius: 16px;
      padding: 16px;
    }
    @media (max-width: 900px) {
      .srv-d-hero {
        grid-template-columns: 1fr;
      }
    }
    
    .srv-d-poster {
      aspect-ratio: 4/3;
      background: #0b0f16;
      border: 1px solid var(--srvd-border);
      border-radius: 14px;
      overflow: hidden;
    }
    .srv-d-poster img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    .srv-d-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .srv-d-title {
      margin: 6px 0;
      font-weight: 900;
      letter-spacing: -0.3px;
      font-size: clamp(22px, 4.2vw, 34px);
    }
    .srv-d-badge {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--srvd-border);
      background: #0e151e;
      color: var(--srvd-badge);
    }
    .srv-d-muted {
      color: var(--srvd-muted);
    }
    
    /* مشخصات کلیدی */
    .srv-d-kv {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      margin: 12px 0 8px;
    }
    .srv-d-kv .it {
      border: 1px solid var(--srvd-border);
      background: #0e141d;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 14px;
      color: #cbd6e7;
    }
    .srv-d-kv .k {
      color: var(--srvd-muted);
      font-size: 12px;
      display: block;
      margin-bottom: 6px;
    }
    
    /* توضیح بلند */
    .srv-d-long {
      border: 1px dashed var(--srvd-border);
      background: #0c1016;
      padding: 14px;
      border-radius: 12px;
      color: #c6d1e3;
      line-height: 1.9;
    }
    
    /* گالری */
    .srv-d-gallery {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      margin-top: 12px;
    }
    .srv-d-thumb {
      aspect-ratio: 16/10;
      border: 1px solid var(--srvd-border);
      border-radius: 12px;
      overflow: hidden;
      background: #0b0f16;
      cursor: pointer;
    }
    .srv-d-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    /* لایت‌باکس */
    .srv-d-lb {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 9999;
    }
    .srv-d-lb.open {
      display: flex;
    }
    .srv-d-lb img {
      max-width: min(1100px, 92vw);
      max-height: 80vh;
      border-radius: 16px;
      border: 1px solid #334;
    }
    .srv-d-lb .close {
      position: absolute;
      top: 16px;
      left: 16px;
      font-size: 14px;
      border: 1px solid var(--srvd-border);
      background: #0d141d;
      color: #eaeef6;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
    }
    
    /* لینک بازگشت */
    .srv-d-back {
      display: inline-block;
      margin-bottom: 10px;
      text-decoration: none;
    }
  </style>

  <div class="srv-d-wrap">
    <div class="srv-d-container">
      <a href="{% url 'service:list' %}" class="srv-d-back srv-d-muted">← بازگشت به لیست</a>

      <!-- هرو: پوستر + اطلاعات اصلی -->
      <section class="srv-d-hero">
        <div class="srv-d-poster">
          {% if service.lable %}
            <img src="{{ service.lable.url }}" alt="{{ service.name }}" />
          {% else %}
            <img src="{% static 'img/placeholder-4x3.webp' %}" alt="{{ service.name }}" />
          {% endif %}
        </div>

        <div>
          <div class="srv-d-title-row">
            <h1 class="srv-d-title">{{ service.name }}</h1>
            {% if service.category %}
              <span class="srv-d-badge">{{ service.category }}</span>
            {% endif %}
          </div>

          {% if service.short_discription %}
            <p class="srv-d-muted" style="margin:6px 0 12px">{{ service.short_discription }}</p>
          {% endif %}

          <div class="srv-d-kv">
            {% if service.status %}
              <div class="it">
                <span class="k">وضعیت</span>{{ service.status }}
              </div>
            {% endif %}
            {% if service.pagespeed %}
              <div class="it">
                <span class="k">PageSpeed</span>{{ service.pagespeed }}
              </div>
            {% endif %}
            {% if service.delivery_time %}
              <div class="it">
                <span class="k">زمان تحویل</span>{{ service.delivery_time }}
              </div>
            {% endif %}
            {% if service.frontend %}
              <div class="it">
                <span class="k">فرانت‌اند</span>{{ service.frontend }}
              </div>
            {% endif %}
            {% if service.backend %}
              <div class="it">
                <span class="k">بک‌اند</span>{{ service.backend }}
              </div>
            {% endif %}
            {% if service.hosting %}
              <div class="it">
                <span class="k">هاستینگ</span>{{ service.hosting }}
              </div>
            {% endif %}
            {% if service.authentication %}
              <div class="it">
                <span class="k">احراز هویت</span>{{ service.authentication }}
              </div>
            {% endif %}
            {% if service.link %}
              <div class="it">
                <span class="k">لینک</span>
                <a href="{{ service.link }}" target="_blank" rel="noopener" style="color:#9ec5ff">{{ service.link }}</a>
              </div>
            {% endif %}
          </div>

          {% if service.long_discription %}
            <div class="srv-d-long">{{ service.long_discription }}</div>
          {% endif %}
        </div>
      </section>

      <!-- گالری تصاویر -->
      {% if images %}
        <h3 style="margin:16px 0 10px">گالری تصاویر</h3>
        <div class="srv-d-gallery" id="srv-d-gallery">
          {% for img in images %}
            <figure class="srv-d-thumb">
              <img src="{{ img.url }}" alt="{{ service.name }} - {{ forloop.counter }}" loading="lazy" />
            </figure>
          {% endfor %}
        </div>

        <!-- Lightbox -->
        <div class="srv-d-lb" id="srv-d-lb">
          <button class="close" type="button" aria-label="بستن">بستن</button>
          <img src="" alt="" />
        </div>
      {% endif %}
    </div>
  </div>

  <script>
    /* --- Lightbox ------------------------------------------------------------ */
    ;(() => {
      const lb = document.getElementById('srv-d-lb')
      const lbImg = lb?.querySelector('img')
      const gallery = document.getElementById('srv-d-gallery')
    
      gallery?.addEventListener('click', (e) => {
        const fig = e.target.closest('.srv-d-thumb')
        if (!fig) return
        lbImg.src = fig.querySelector('img').src
        lb.classList.add('open')
      })
    
      lb?.addEventListener('click', (e) => {
        if (e.target === lb || e.target.classList.contains('close')) lb.classList.remove('open')
      })
    
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') lb.classList.remove('open')
      })
    })()
  </script>
{% endblock %}
